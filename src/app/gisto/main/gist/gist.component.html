<div *ngFor="let file of values(gistStore.currentGist.files); index as fileIndex">
  <gist-header>
    <gist-file-icon>
      <span class="fa-stack">
        <i class="fa fa-file-o"></i>
        <strong style="font-size: 8px;" class="fa-stack-1x fa-stack-text file-text">
          {{ file.filename.split('.')[1] }}
        </strong>
      </span>
    </gist-file-icon>

    <gist-file-name>
        <input *ngIf="uiStore.editMode"
               #filenameInput
               (keyup)="changeFile(file.filename, filenameInput.value)"
               placeholder="untitled"
               [value]="file.filename" />
        <span *ngIf="!uiStore.editMode">{{ file.filename }}</span>
    </gist-file-name>

    <gist-utils
      *ngIf="!uiStore.editMode && file.language.toLowerCase() === 'markdown'"
      icon="fa {{ showMarkDown === fileIndex ? 'fa-eye' : 'fa-eye-slash' }}"
      (click)="toggleMarkDown(fileIndex)">
    </gist-utils>
    <gist-utils icon="{{ showMenu === fileIndex ? 'fa-close' : 'fa-ellipsis-v' }}" (click)="showMenuForFile(fileIndex)">
      <ul *ngIf="showMenu === fileIndex">
        <li><a target="_new" href="https://gist.github.com/{{ gistStore.currentGist.owner.login }}/{{ gistStore.currentGist.id }}#file-{{ file.filename }}">Open on web</a></li>
        <li><a download="{{ file.filename }}" href="{{ file.file_raw }}">Download</a></li>
        <li CopyToClipBoard="{{ file.content }}">Copy file content to clipboard</li>
        <li class="color-danger">Delete</li>
      </ul>
    </gist-utils>
    <gist-utils icon="{{ gistStore.gists[gistStore.currentGist.id].files[file.filename].collapsed ? 'fa-angle-down' : 'fa-angle-up' }}"
                (click)="toggleFileContent(gistStore.currentGist.id, file.filename)">
    </gist-utils>
  </gist-header>
  <gist-body *ngIf="uiStore.editMode || !gistStore.gists[gistStore.currentGist.id].files[file.filename].collapsed">
    <markdown *ngIf="!uiStore.editMode && file.language.toLowerCase() === 'markdown' && showMarkDown === fileIndex && !uiStore.editMode">
      {{ file.content }}
    </markdown>
    <td-code-editor
      class="editor"
      #fileContent
      theme="{{ settingsStore.theme }}"
      (keyup)="changeFileContent(file.filename, fileContent.value)"
      automaticLayout
      language="{{ file.language.toLowerCase() || 'text' }}"
      [value]="file.content"
      [editorOptions]="{ readOnly: uiStore.editMode, scrollBeyondLastLine: false }"></td-code-editor>
  </gist-body>
</div>
